<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üåä OceanSafe - SIH 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- MAPBOX GL JS -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />

  <!-- Firebase v8 (keeping original version) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: #f8fafc;
      color: #334155;
      overflow-x: hidden;
    }

    /* Navigation */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(135deg, #111827, #374151);
      color: white;
      padding: 10px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    nav h2 {
      margin: 0;
      font-weight: 700;
      font-size: 1.4rem;
    }

    .search-container {
      position: relative;
      flex-grow: 1;
      max-width: 300px;
      margin: 0 20px;
    }

    .search-bar {
      width: 100%;
      padding: 8px 35px 8px 15px;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .search-bar::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .search-bar:focus {
      outline: none;
      background: rgba(255,255,255,0.25);
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      pointer-events: none;
    }

    .auth-buttons button,
    .auth-buttons a.button {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 6px 15px;
      margin-left: 8px;
      border-radius: 15px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 13px;
    }

    .auth-buttons button:hover,
    .auth-buttons a.button:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    /* Main Container */
    .main-container {
      position: relative;
      top: 60px;
      height: calc(100vh - 60px);
      width: 100%;
    }

    /* View Toggle Navigation */
    .view-toggle-nav {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 600;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 25px;
      padding: 6px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .view-toggle-nav button {
      background: transparent;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      color: #64748b;
      transition: all 0.3s ease;
      margin: 0 3px;
    }

    .view-toggle-nav button.active {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    }

    .view-toggle-nav button:not(.active):hover {
      background: rgba(37, 99, 235, 0.1);
      color: #2563eb;
    }

    /* View Container */
    .view-container {
      position: relative;
      height: 100%;
      width: 100%;
    }

    .overview-view,
    .map-view {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .overview-view.hidden,
    .map-view.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(20px);
    }

    /* Enhanced Overview Styles */
    .overview-view {
      padding: 60px 20px 20px 20px;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      overflow-y: auto;
    }

    .overview-header {
      background: linear-gradient(135deg, #1e40af, #3b82f6);
      color: white;
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .overview-header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"/><circle cx="50" cy="50" r="25" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"/></svg>') no-repeat center;
      opacity: 0.3;
    }

    .overview-header-content {
      position: relative;
      z-index: 1;
    }

    .overview-header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .overview-header p {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 25px;
    }

    .overview-actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .overview-actions button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .overview-actions button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .overview-actions button.primary {
      background: white;
      color: #1e40af;
    }

    .overview-actions button.primary:hover {
      background: #f1f5f9;
    }

    /* Alert Banner */
    .alert-banner {
      background: linear-gradient(135deg, #dc2626, #ef4444);
      color: white;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 15px;
      animation: alertPulse 2s infinite;
    }

    @keyframes alertPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.9; }
    }

    .alert-icon {
      font-size: 2rem;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* Enhanced Stats Grid */
    .overview-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .overview-stat-card {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      border-left: 5px solid;
    }

    .overview-stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.12);
    }

    .overview-stat-card.reports { border-left-color: #3b82f6; }
    .overview-stat-card.hazards { border-left-color: #dc2626; }
    .overview-stat-card.social { border-left-color: #10b981; }
    .overview-stat-card.resolved { border-left-color: #f59e0b; }

    .overview-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 80px;
      height: 80px;
      opacity: 0.1;
      border-radius: 50%;
    }

    .overview-stat-card.reports::before { background: #3b82f6; }
    .overview-stat-card.hazards::before { background: #dc2626; }
    .overview-stat-card.social::before { background: #10b981; }
    .overview-stat-card.resolved::before { background: #f59e0b; }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .overview-stat-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .stat-trend {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 600;
    }

    .stat-trend.up {
      background: #fef2f2;
      color: #dc2626;
    }

    .stat-trend.down {
      background: #f0fdf4;
      color: #16a34a;
    }

    .overview-stat-number {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 8px;
      display: block;
    }

    .overview-stat-card.reports .overview-stat-number { color: #3b82f6; }
    .overview-stat-card.hazards .overview-stat-number { color: #dc2626; }
    .overview-stat-card.social .overview-stat-number { color: #10b981; }
    .overview-stat-card.resolved .overview-stat-number { color: #f59e0b; }

    .overview-stat-label {
      font-size: 1.1rem;
      color: #64748b;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .overview-stat-subtitle {
      font-size: 0.9rem;
      color: #94a3b8;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Quick Stats Bar */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .quick-stat {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      text-align: center;
      transition: all 0.3s ease;
    }

    .quick-stat:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    }

    .quick-stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 5px;
    }

    .quick-stat-label {
      font-size: 0.9rem;
      color: #64748b;
      font-weight: 500;
    }

    /* Activity Timeline */
    .timeline-section {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      margin-bottom: 30px;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .timeline-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e40af;
    }

    .timeline-filter {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 1px solid #e2e8f0;
      background: white;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      transition: all 0.3s ease;
    }

    .filter-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .timeline-list {
      position: relative;
    }

    .timeline-item {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .timeline-item:hover {
      background: #f1f5f9;
      transform: translateX(5px);
    }

    .timeline-indicator {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
      font-weight: 600;
      flex-shrink: 0;
    }

    .timeline-indicator.critical { background: #dc2626; }
    .timeline-indicator.warning { background: #f59e0b; }
    .timeline-indicator.info { background: #3b82f6; }
    .timeline-indicator.success { background: #10b981; }

    .timeline-content {
      flex: 1;
    }

    .timeline-title-text {
      font-weight: 600;
      color: #334155;
      margin-bottom: 5px;
    }

    .timeline-description {
      font-size: 0.9rem;
      color: #64748b;
      margin-bottom: 8px;
    }

    .timeline-meta {
      display: flex;
      gap: 15px;
      font-size: 0.8rem;
      color: #94a3b8;
    }

    /* Enhanced Metrics Grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .metrics-card {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    .metrics-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-placeholder {
      height: 200px;
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-weight: 600;
      border: 2px dashed #cbd5e1;
    }

    /* Map View Styles */
    .map-view {
      display: flex;
      flex-direction: column;
    }

    .map-section {
      position: relative;
      height: 90vh;
      width: 100%;
      background: #1e293b;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    /* Floating Stats */
    .floating-stats {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 500;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      width: 280px;
    }

    .floating-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .floating-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.2);
      background: rgba(255, 255, 255, 1);
    }

    .floating-card .number {
      font-size: 1.8rem;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    .floating-card.reports .number { color: #2563eb; }
    .floating-card.hazards .number { color: #ef4444; }
    .floating-card.social .number { color: #10b981; }
    .floating-card.resolved .number { color: #f59e0b; }

    .floating-card .label {
      font-size: 11px;
      color: #64748b;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Map Controls */
    .map-controls {
      position: absolute;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      z-index: 500;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .map-control-btn {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border: none;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .map-control-btn:hover {
      transform: scale(1.1);
      background: white;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    /* Events Panel */
    .events-trigger {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 500;
    }

    .events-btn {
      background: rgba(37, 99, 235, 0.95);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(15px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }

    .events-btn:hover {
      background: rgba(37, 99, 235, 1);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.4);
    }

    .alert-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .content-section {
      height: 10vh;
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      padding: 15px 30px;
      border-top: 3px solid #2563eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }

    .content-left h1 {
      font-size: 1.4rem;
      margin: 0 0 4px 0;
      color: #1e40af;
      font-weight: 700;
    }

    .content-left p {
      margin: 0;
      color: #64748b;
      font-size: 13px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
    }

    .action-buttons button {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
    }

    .action-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }

    /* Events Sidebar */
    .events-sidebar {
      position: fixed;
      top: 60px;
      right: -400px;
      width: 380px;
      height: calc(100vh - 60px);
      background: white;
      box-shadow: -6px 0 30px rgba(0,0,0,0.2);
      z-index: 1500;
      transition: right 0.4s ease;
      overflow-y: auto;
    }

    .events-sidebar.open {
      right: 0;
    }

    .sidebar-header {
      position: relative;
      padding: 25px;
      background: linear-gradient(135deg, #1e40af, #3b82f6);
      color: white;
    }

    .sidebar-close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255,255,255,0.12);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease, transform 0.12s ease;
    }

    .sidebar-close-btn:hover {
      background: rgba(255,255,255,0.22);
      transform: translateY(-1px);
    }

    .sidebar-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .event-count {
      font-size: 13px;
      opacity: 0.9;
    }

    .events-list {
      padding: 20px;
    }

    .event-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 15px;
      border-left: 4px solid;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .event-item:hover {
      background: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }

    .event-item.tsunami { border-left-color: #dc2626; }
    .event-item.storm { border-left-color: #ea580c; }
    .event-item.waves { border-left-color: #d97706; }
    .event-item.flood { border-left-color: #0891b2; }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .event-type {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 4px 8px;
      border-radius: 6px;
      color: white;
    }

    .event-type.tsunami { background: #dc2626; }
    .event-type.storm { background: #ea580c; }
    .event-type.waves { background: #d97706; }
    .event-type.flood { background: #0891b2; }

    .event-time {
      font-size: 11px;
      color: #64748b;
    }

    .event-location {
      font-size: 14px;
      font-weight: 600;
      color: #334155;
      margin-bottom: 6px;
    }

    .event-description {
      font-size: 12px;
      color: #64748b;
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .event-stats {
      display: flex;
      gap: 15px;
      font-size: 11px;
      color: #64748b;
    }

    /* Modals */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      width: 420px;
      animation: modalFadeIn 0.3s ease;
      position: relative;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-content h3 {
      margin-top: 0;
      text-align: center;
      color: #1e40af;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 25px;
    }

    .modal-content input,
    .modal-content select,
    .modal-content textarea {
      width: 100%;
      padding: 12px 16px;
      margin: 8px 0;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .modal-content input:focus,
    .modal-content select:focus,
    .modal-content textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal-content button {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 15px;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .modal-content button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: #64748b;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: #ef4444;
    }

    .toggle-text {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
      color: #64748b;
    }

    .toggle-text a {
      color: #2563eb;
      font-weight: 600;
      text-decoration: none;
    }

    .toggle-text a:hover {
      text-decoration: underline;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .overview-stats {
        grid-template-columns: 1fr;
      }

      .quick-stats {
        grid-template-columns: 1fr 1fr;
      }

      .metrics-grid {
        grid-template-columns: 1fr;
      }

      .timeline-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .floating-stats {
        width: 240px;
        gap: 8px;
      }

      .floating-card {
        padding: 12px;
      }

      .content-section {
        flex-direction: column;
        height: auto;
        padding: 15px;
      }

      .action-buttons {
        margin-top: 10px;
      }

      .events-sidebar {
        width: 100%;
        right: -100%;
      }

      .search-container {
        max-width: 200px;
        margin: 0 15px;
      }

      nav {
        padding: 0 15px;
      }

      .overview-header h1 {
        font-size: 2rem;
      }

      .overview-actions {
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav>
    <h2>üåä OceanSafe</h2>
    <div class="search-container">
      <input type="text" class="search-bar" id="searchBar" placeholder="Search locations, hazards...">
      <span class="search-icon">üîç</span>
    </div>
    <div class="auth-buttons" id="authButtonsContainer">
      <a class="button" href="auth.html">Citizen Login</a>
      <button onclick="openModal('adminModal')">Admin</button>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="main-container">
    
    <!-- View Toggle Navigation 
    <div class="view-toggle-nav">
      <button id="overviewBtn" class="active" onclick="switchToOverview()">üìä Dashboard</button>
      <button id="mapBtn" onclick="switchToMap()">üó∫ Live Map</button>
    </div>
    -->
    <!-- View Container -->
    <div class="view-container">
      
      <!-- ENHANCED OVERVIEW VIEW -->
      <div class="overview-view" id="overviewView">
        
        <!-- Header Section -->
        <div class="overview-header">
          <div class="overview-header-content">
            <h1 id="mainHeader">Ocean Hazard Command Center</h1>
            <p id="subText">Real-time monitoring and response coordination for India's coastal safety</p>
            <div class="overview-actions">
              <button class="primary" onclick="openModal('reportModall')">üìù Submit New Report</button>
              <button onclick="switchToMap()">üó∫ View Live Map</button>
              <button onclick="showAnalyticss()">üìä Analytics Dashboard</button>
              <button onclick="showEmergencyResponse()">üö® Emergency Response</button>
            </div>
          </div>
        </div>

        <!-- Alert Banner -->
        <div class="alert-banner">
          <div class="alert-icon">‚ö†Ô∏è</div>
          <div>
            <strong>Critical Alert:</strong> Tsunami warning active for Chennai Coast. 
            <span style="margin-left: 10px;">
              <button style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 12px; border-radius: 15px; cursor: pointer;" onclick="showAlertDetails()">View Details</button>
            </span>
          </div>
        </div>

        <!-- Enhanced Stats Overview -->
        <div class="overview-stats">
          <div class="overview-stat-card hazards">
            <div class="stat-header">
              <div class="overview-stat-icon">üö®</div>
              <div class="stat-trend up">‚Üë 15%</div>
            </div>
            <span class="overview-stat-number" id="criticalHazards">8</span>
            <div class="overview-stat-label">Critical Hazards</div>
            <div class="overview-stat-subtitle">
              <span>3 tsunami alerts</span>
              <span>‚Ä¢</span>
              <span>Active now</span>
            </div>
          </div>

          <div class="overview-stat-card reports">
            <div class="stat-header">
              <div class="overview-stat-icon">üìä</div>
              <div class="stat-trend up">‚Üë 23%</div>
            </div>
            <span class="overview-stat-number" id="totalReports">1247</span>
            <div class="overview-stat-label">Total Reports</div>
            <div class="overview-stat-subtitle">
              <span>+47 today</span>
              <span>‚Ä¢</span>
              <span>96% verified</span>
            </div>
          </div>

          <div class="overview-stat-card resolved">
            <div class="stat-header">
              <div class="overview-stat-icon">‚úÖ</div>
              <div class="stat-trend down">‚Üì 8%</div>
            </div>
            <span class="overview-stat-number" id="resolvedIssues">234</span>
            <div class="overview-stat-label">Resolved Issues</div>
            <div class="overview-stat-subtitle">
              <span>94% success rate</span>
              <span>‚Ä¢</span>
              <span>Avg 2.3h response</span>
            </div>
          </div>

          <div class="overview-stat-card social">
            <div class="stat-header">
              <div class="overview-stat-icon">üì±</div>
              <div class="stat-trend up">‚Üë 156%</div>
            </div>
            <span class="overview-stat-number" id="socialMentions">12.4K</span>
            <div class="overview-stat-label">Social Mentions</div>
            <div class="overview-stat-subtitle">
              <span>#TsunamiAlert trending</span>
              <span>‚Ä¢</span>
              <span>68% concern level</span>
            </div>
          </div>
        </div>

        <!-- Quick Stats Bar -->
        <div class="quick-stats">
          <div class="quick-stat">
            <div class="quick-stat-number" id="activeReporters">15</div>
            <div class="quick-stat-label">Active Reporters</div>
          </div>
          <div class="quick-stat">
            <div class="quick-stat-number">7.2M</div>
            <div class="quick-stat-label">People Protected</div>
          </div>
          <div class="quick-stat">
            <div class="quick-stat-number">23</div>
            <div class="quick-stat-label">Agencies Connected</div>
          </div>
          <div class="quick-stat">
            <div class="quick-stat-number">99.2%</div>
            <div class="quick-stat-label">System Uptime</div>
          </div>
        </div>

        <!-- Activity Timeline -->
        <div class="timeline-section">
          <div class="timeline-header">
            <h2 class="timeline-title">üïí Recent Activity</h2>
            <div class="timeline-filter">
              <button class="filter-btn active" onclick="filterTimeline('all')">All</button>
              <button class="filter-btn" onclick="filterTimeline('critical')">Critical</button>
              <button class="filter-btn" onclick="filterTimeline('reports')">Reports</button>
              <button class="filter-btn" onclick="filterTimeline('resolved')">Resolved</button>
            </div>
          </div>

          <div class="timeline-list" id="timelineList">
            <div class="timeline-item" data-type="critical">
              <div class="timeline-indicator critical">‚ö†Ô∏è</div>
              <div class="timeline-content">
                <div class="timeline-title-text">Tsunami Alert Issued - Chennai Coast</div>
                <div class="timeline-description">Water recession observed at Marina Beach. Emergency services notified. Evacuation protocols activated.</div>
                <div class="timeline-meta">
                  <span>üìç Chennai, Tamil Nadu</span>
                  <span>‚è∞ 15 mins ago</span>
                  <span>üë§ Citizen Report</span>
                </div>
              </div>
            </div>

            <div class="timeline-item" data-type="reports">
              <div class="timeline-indicator warning">üåä</div>
              <div class="timeline-content">
                <div class="timeline-title-text">High Wave Alert - Mumbai Harbor</div>
                <div class="timeline-description">Wave height exceeding 4 meters. Port operations suspended. Fishing vessels advised to return.</div>
                <div class="timeline-meta">
                  <span>üìç Mumbai, Maharashtra</span>
                  <span>‚è∞ 32 mins ago</span>
                  <span>üë®‚Äç‚úàÔ∏è Port Authority</span>
                </div>
              </div>
            </div>

            <div class="timeline-item" data-type="resolved">
              <div class="timeline-indicator success">‚úÖ</div>
              <div class="timeline-content">
                <div class="timeline-title-text">Coastal Flooding Resolved - Kochi</div>
                <div class="timeline-description">Water levels returned to normal. Roads reopened. 127 people safely evacuated and returned.</div>
                <div class="timeline-meta">
                  <span>üìç Kochi, Kerala</span>
                  <span>‚è∞ 1 hour ago</span>
                  <span>üèõÔ∏è NDRF Team</span>
                </div>
              </div>
            </div>

            <div class="timeline-item" data-type="reports">
              <div class="timeline-indicator info">üìä</div>
              <div class="timeline-content">
                <div class="timeline-title-text">Social Media Spike Detected</div>
                <div class="timeline-description">456% increase in ocean-related posts from Visakhapatnam region. AI analysis indicates weather concern.</div>
                <div class="timeline-meta">
                  <span>üìç Visakhapatnam, Andhra Pradesh</span>
                  <span>‚è∞ 2 hours ago</span>
                  <span>ü§ñ NLP System</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Metrics -->
        <div class="metrics-grid">
          <div class="metrics-card">
            <h3 class="metrics-title">üìà Hazard Trends (Last 30 Days)</h3>
            <div class="chart-placeholder" id="trendChart">
              <canvas id="hazardTrendChart" width="400" height="200"></canvas>
            </div>
          </div>

          <div class="metrics-card">
            <h3 class="metrics-title">üéØ Response Effectiveness</h3>
            <div style="display: grid; gap: 15px; margin-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
                <span style="font-weight: 600;">Average Response Time</span>
                <span style="color: #10b981; font-weight: 700;">2.3 hours</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
                <span style="font-weight: 600;">Alert Accuracy</span>
                <span style="color: #3b82f6; font-weight: 700;">96.8%</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
                <span style="font-weight: 600;">Citizen Engagement</span>
                <span style="color: #f59e0b; font-weight: 700;">84.2%</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
                <span style="font-weight: 600;">Lives Protected</span>
                <span style="color: #dc2626; font-weight: 700;">7.2M+</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MAP VIEW -->
      <div class="map-view hidden" id="mapView">
        <div class="map-section">
          <div id="map"></div>
          
          <!-- Floating Stats -->
          <div class="floating-stats">
            <div class="floating-card reports">
              <span class="number" id="reportCount">1247</span>
              <span class="label">Reports</span>
            </div>
            <div class="floating-card hazards">
              <span class="number">8</span>
              <span class="label">Active</span>
            </div>
            <div class="floating-card social">
              <span class="number">12.4K</span>
              <span class="label">Social</span>
            </div>
            <div class="floating-card resolved">
              <span class="number">234</span>
              <span class="label">Resolved</span>
            </div>
          </div>

          <!-- Map Controls -->
          <div class="map-controls">
            <button class="map-control-btn" onclick="toggleHeatmap()" title="Heatmap">üî•</button>
            <button class="map-control-btn" onclick="toggleClusters()" title="Clusters">üìç</button>
            <button class="map-control-btn" onclick="refreshData()" title="Refresh">üîÑ</button>
            <button class="map-control-btn" onclick="toggleFullscreen()" title="Fullscreen">‚õ∂</button>
          </div>

          <!-- Events Panel Trigger -->
          <div class="events-trigger">
            <button class="events-btn" onclick="toggleEventsPanel()">
              Live Events
              <span class="alert-badge">8</span>
            </button>
          </div>
        </div>

        <!-- Content Section -->
        <div class="content-section">
          <div class="content-left">
            <h1>üó∫ Live Hazard Map</h1>
            <p>Real-time visualization of ocean hazards across India's coastline</p>
          </div>
          <div class="action-buttons">
            <button onclick="switchToOverview()">üìä Back to Dashboard</button>
            <button onclick="toggleEventsPanel()">üìã Events Panel</button>
            <button onclick="askForLocation()">üìç My Location</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Events Sidebar -->
  <div class="events-sidebar" id="eventsSidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">üö® Live Events</div>
      <div class="event-count">8 active incidents</div>
      <button class="sidebar-close-btn" aria-label="Close events panel" onclick="toggleEventsPanel()">‚úï</button>
    </div>
    <div class="events-list" id="eventsList">
      <div class="event-item tsunami">
        <div class="event-header">
          <span class="event-type tsunami">Tsunami</span>
          <span class="event-time">15 mins ago</span>
        </div>
        <div class="event-location">üìç Chennai Coast</div>
        <div class="event-description">Unusual wave patterns reported by fishermen</div>
        <div class="event-stats">
          <span>üìä 23 reports</span>
          <span>‚ö† Critical</span>
        </div>
      </div>

      <div class="event-item storm">
        <div class="event-header">
          <span class="event-type storm">Storm</span>
          <span class="event-time">32 mins ago</span>
        </div>
        <div class="event-location">üìç Mumbai Harbor</div>
        <div class="event-description">Storm surge warning for next 6 hours</div>
        <div class="event-stats">
          <span>üìä 45 reports</span>
          <span>‚ö† High</span>
        </div>
      </div>

      <div class="event-item waves">
        <div class="event-header">
          <span class="event-type waves">High Waves</span>
          <span class="event-time">1 hour ago</span>
        </div>
        <div class="event-location">üìç Kochi Backwaters</div>
        <div class="event-description">Wave height exceeding 4 meters</div>
        <div class="event-stats">
          <span>üìä 18 reports</span>
          <span>‚ö† Medium</span>
        </div>
      </div>

      <div class="event-item flood">
        <div class="event-header">
          <span class="event-type flood">Flooding</span>
          <span class="event-time">2 hours ago</span>
        </div>
        <div class="event-location">üìç Visakhapatnam Port</div>
        <div class="event-description">Coastal flooding near port area</div>
        <div class="event-stats">
          <span>üìä 31 reports</span>
          <span>‚ö† High</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="signupModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('signupModal')">&times;</span>
      <h3>Sign Up</h3>
      <input type="text" id="fullName" placeholder="Full Name" required />
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <input type="text" id="contact" placeholder="Contact Number" required />
      <label><input type="checkbox" id="locationPerm"> Allow Location Access</label><br>
      <label><input type="checkbox" id="smsPerm"> Allow SMS Alerts</label><br><br>
      <button onclick="signupUser()">Create Account</button>
      <p class="toggle-text">Already have an account? <a href="auth.html">Login</a></p>
    </div>
  </div>

  <div id="reportModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('reportModal')">&times;</span>
      <h3>Submit Hazard Report</h3>
      <input type="text" id="reportLocation" placeholder="Location" required />
      <select id="reportType">
        <option value="">Select Hazard Type</option>
        <option value="tsunami">Tsunami</option>
        <option value="storm">Storm Surge</option>
        <option value="waves">High Waves</option>
        <option value="flood">Coastal Flooding</option>
      </select>
      <textarea id="reportDescription" placeholder="Description" rows="4"></textarea>
      <button onclick="submitReport()">Submit Report</button>
    </div>
  </div>

  <div id="adminModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('adminModal')">&times;</span>
      <h3>Admin Login</h3>
      <input type="text" id="adminEmail" placeholder="Admin Email" required />
      <input type="password" id="adminPassword" placeholder="Password" required />
      <button onclick="adminLogin()">Login</button>
    </div>
  </div>

  <script>
    console.log("üåä OceanSafe Dashboard starting...");
    
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDRq0DwS1ikDzvl27MTnG4lZfVDJT2lzxI",
      authDomain: "hackathonapp-f8695.firebaseapp.com",
      projectId: "hackathonapp-f8695",
      storageBucket: "hackathonapp-f8695.appspot.com",
      messagingSenderId: "1098082520052",
      appId: "1:1098082520052:web:c51e92571d171c903947a1",
      measurementId: "G-2L479LZ9QV"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log("‚úÖ Firebase initialized");

    // Admin credentials
    const ADMIN_EMAIL = "admin@gmail.com";
    const ADMIN_PASS = "admin@123";

    // Role management
    const urlParams = new URLSearchParams(window.location.search);
    let role = urlParams.get('role') || "guest";

    const headerTitle = document.getElementById("mainHeader");
    const subText = document.getElementById("subText");
    const authButtonsContainer = document.getElementById("authButtonsContainer");

    function renderAuthButtons(r){
      if(r === "admin" || r === "citizen"){
        authButtonsContainer.innerHTML = `
          <button class="button" onclick="logout()">Logout</button>
        `;
      } else {
        authButtonsContainer.innerHTML = `
          <a class="button" href="auth.html">Citizen Login</a>
          <button onclick="openModal('adminModal')">Admin</button>
        `;
      }
    }

    function applyRoleUI(r){
      if(r === "admin"){
        if(headerTitle) headerTitle.textContent = "üîê Admin Command Center";
        if(subText) subText.textContent = "Administrative controls and system monitoring";
      } 
      else if(r === "citizen"){
        if(headerTitle) headerTitle.textContent = "üë§ Citizen Reporter Dashboard";
        if(subText) subText.textContent = "Submit geotagged reports and track hazard status";
        setTimeout(() => askForLocation(), 300);
      } 
      else {
        if(headerTitle) headerTitle.textContent = "Ocean Hazard Command Center";
        if(subText) subText.textContent = "Real-time monitoring and response coordination for India's coastal safety";
      }
      renderAuthButtons(r);
    }

    // Apply role-based UI
    applyRoleUI(role);
    console.log("‚úÖ Role UI applied:", role);

    // View switching functions
    window.switchToOverview = function() {
      document.getElementById('overviewView').classList.remove('hidden');
      document.getElementById('mapView').classList.add('hidden');
      document.getElementById('overviewBtn').classList.add('active');
      document.getElementById('mapBtn').classList.remove('active');
      setTimeout(() => {
        initializeCharts();
        animateNumbers();
      }, 100);
    }

    window.switchToMap = function() {
      document.getElementById('overviewView').classList.add('hidden');
      document.getElementById('mapView').classList.remove('hidden');
      document.getElementById('overviewBtn').classList.remove('active');
      document.getElementById('mapBtn').classList.add('active');
      setTimeout(() => {
        if (window.map && window.map.resize) {
          window.map.resize();
        }
      }, 100);
    }

    // Enhanced Dashboard Functions
    window.showAnalytics = function() {
      alert('üìä Advanced analytics dashboard - implementing detailed reports and predictive models');
    }

  /*  window.showEmergencyResponse = function() {
      alert('üö® Emergency response protocols activated - coordinating with NDRF and local authorities');
    }*/

    window.showAlertDetails = function() {
      alert('‚ö†Ô∏è Critical tsunami alert details:\n\n‚Ä¢ Location: Chennai Coast, Marina Beach\n‚Ä¢ Magnitude: High risk\n‚Ä¢ Evacuation: In progress\n‚Ä¢ Emergency contacts: Active');
    }

    window.submitReport = function() {
      const location = document.getElementById('reportLocation').value;
      const type = document.getElementById('reportType').value;
      const description = document.getElementById('reportDescription').value;
      
      if (!location || !type || !description) {
        alert('Please fill all fields');
        return;
      }
      
      alert(`‚úÖ Report submitted successfully!\n\nLocation: ${location}\nType: ${type}\nDescription: ${description}`);
      closeModal('reportModal');
      
      // Update counters
      const totalReports = document.getElementById('totalReports');
      if (totalReports) {
        const currentCount = parseInt(totalReports.textContent.replace(/[^\d]/g, ''));
        totalReports.textContent = (currentCount + 1).toLocaleString();
      }
    }

    // Timeline filter functionality
    window.filterTimeline = function(type) {
      const filterBtns = document.querySelectorAll('.filter-btn');
      const timelineItems = document.querySelectorAll('.timeline-item');
      
      filterBtns.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      timelineItems.forEach(item => {
        if (type === 'all' || item.dataset.type === type) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Number animation function
    function animateNumbers() {
      const numbers = document.querySelectorAll('.overview-stat-number, .quick-stat-number');
      numbers.forEach(num => {
        const finalValue = num.textContent;
        const numericValue = parseFloat(finalValue.replace(/[^\d.]/g, ''));
        const suffix = finalValue.replace(/[\d.]/g, '');
        
        let currentValue = 0;
        const increment = numericValue / 50;
        
        const timer = setInterval(() => {
          currentValue += increment;
          if (currentValue >= numericValue) {
            currentValue = numericValue;
            clearInterval(timer);
          }
          
          if (numericValue >= 1000) {
            num.textContent = (Math.floor(currentValue / 1000 * 10) / 10) + 'K' + suffix.replace('K', '');
          } else {
            num.textContent = Math.floor(currentValue) + suffix;
          }
        }, 30);
      });
    }

    // Initialize charts
    function initializeCharts() {
      const canvas = document.getElementById('hazardTrendChart');
      if (canvas && !canvas.chart) {
        const ctx = canvas.getContext('2d');
        canvas.chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
              label: 'Tsunami Alerts',
              data: [2, 5, 3, 8],
              borderColor: '#dc2626',
              backgroundColor: 'rgba(220, 38, 38, 0.1)',
              tension: 0.4
            }, {
              label: 'Storm Surge',
              data: [4, 7, 6, 12],
              borderColor: '#ea580c',
              backgroundColor: 'rgba(234, 88, 12, 0.1)',
              tension: 0.4
            }, {
              label: 'Coastal Flooding',
              data: [6, 8, 9, 15],
              borderColor: '#0891b2',
              backgroundColor: 'rgba(8, 145, 178, 0.1)',
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        console.log("‚úÖ Charts initialized");
      }
    }

    // Global functions
    window.logout = async function(){
      try{
        if(auth && typeof signOut === 'function'){
          await signOut(auth);
        }
      } catch(e){
        console.warn('Signout error:', e);
      }
      window.location.href = 'index.html';
    }

    window.openModal = function(id){ 
      document.getElementById(id).style.display = "flex"; 
    }

    window.closeModal = function(id){ 
      document.getElementById(id).style.display = "none"; 
    }

    window.onclick = (e) => { 
      if (e.target.classList && e.target.classList.contains('modal')) 
        e.target.style.display = 'none'; 
    }

    window.toggleEventsPanel = function() {
      const sidebar = document.getElementById('eventsSidebar');
      sidebar.classList.toggle('open');
    }

    window.adminLogin = function(){
      const email = document.getElementById("adminEmail").value.trim();
      const pass = document.getElementById("adminPassword").value.trim();

      if(email === ADMIN_EMAIL && pass === ADMIN_PASS){
        alert("‚úÖ Admin Logged In");
        closeModal('adminModal');
        window.location.href = "index.html?role=admin";
      } else {
        alert("‚ùå Invalid Admin Credentials");
      }
    }

    window.signupUser = async function () {
      const name = document.getElementById('fullName').value;
      const email = document.getElementById('signupEmail').value;
      const pass = document.getElementById('signupPassword').value;
      const contact = document.getElementById('contact').value;
      const locationPerm = document.getElementById('locationPerm').checked;
      const smsPerm = document.getElementById('smsPerm').checked;

      if (!email || !pass) {
        alert('Please fill email and password');
        return;
      }

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, pass);
        const uid = userCred.user.uid;

        await setDoc(doc(db, "users", uid), {
          name, email, contact, locationPerm, smsPerm, createdAt: new Date()
        });

        alert('‚úÖ User registered!');
        closeModal('signupModal');
        window.location.href = 'index.html?role=citizen';
      } catch (err) {
        alert(err.message);
      }
    }

    window.showCharts = function() {
      alert('Charts view - will implement detailed analytics');
    }

    // Initialize Charts
    function initializeCharts() {
      const barCtx = document.getElementById('barChart');
      if (barCtx && !barCtx.chart) {
        barCtx.chart = new Chart(barCtx, {
          type: 'bar',
          data: {
            labels: ['High Waves','Coastal Flood','Tsunami','Storm Surge'],
            datasets: [{ 
              label:'Reports', 
              data:[45,31,12,18], 
              backgroundColor:['#3b82f6','#0891b2','#dc2626','#ea580c'],
              borderRadius: 8,
              borderSkipped: false
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, grid: { display: false } },
              x: { grid: { display: false } }
            }
          }
        });
      }

      const pieCtx = document.getElementById('pieChart');
      if (pieCtx && !pieCtx.chart) {
        pieCtx.chart = new Chart(pieCtx, {
          type: 'doughnut',
          data: { 
            labels:['Resolved','In Progress','Critical'], 
            datasets: [{ 
              data:[67,53,8], 
              backgroundColor:['#10b981','#f59e0b','#ef4444'],
              borderWidth: 0
            }] 
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { padding: 20, usePointStyle: true }
              }
            }
          }
        });
      }
    }

    setTimeout(initializeCharts, 500);

    // Mapbox Implementation
    mapboxgl.accessToken = 'pk.eyJ1Ijoibi1tLTc3NyIsImEiOiJjbWY5bTZteG0xYmt1MmlwZmZ1MDFhcXowIn0.hpURL94emG4qMoXAmP0eZA'; // Replace with your Mapbox token
    
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [78.96, 20.59],
      zoom: 5,
      pitch: 0,
      bearing: 0
    });

    const hazardData = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [80.2707, 13.0827] },
          "properties": { 
            "type": "tsunami", 
            "title": "Tsunami Alert", 
            "location": "Chennai Coast",
            "description": "Unusual wave patterns reported by local fishermen",
            "severity": "Critical",
            "reports": 23,
            "time": "15 mins ago"
          }
        },
        {
          "type": "Feature", 
          "geometry": { "type": "Point", "coordinates": [72.8347, 18.9220] },
          "properties": { 
            "type": "storm", 
            "title": "Storm Surge", 
            "location": "Mumbai Harbor",
            "description": "Storm surge warning issued for next 6 hours",
            "severity": "High",
            "reports": 45,
            "time": "32 mins ago"
          }
        },
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [76.2673, 9.9312] },
          "properties": { 
            "type": "waves", 
            "title": "High Waves", 
            "location": "Kochi Backwaters",
            "description": "High waves causing flooding in coastal areas",
            "severity": "Medium",
            "reports": 18,
            "time": "1 hour ago"
          }
        },
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [83.2185, 17.6868] },
          "properties": { 
            "type": "flood", 
            "title": "Coastal Flood", 
            "location": "Visakhapatnam Port",
            "description": "Coastal flooding reported near port area",
            "severity": "High", 
            "reports": 31,
            "time": "2 hours ago"
          }
        },
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [74.1240, 15.2993] },
          "properties": { 
            "type": "tsunami", 
            "title": "Critical Alert", 
            "location": "Goa Beaches",
            "description": "Sudden water recession observed",
            "severity": "Critical",
            "reports": 12,
            "time": "45 mins ago"
          }
        }
      ]
    };

    map.on('load', () => {
      console.log('üó∫ Mapbox loaded successfully!');
      
      map.addSource('hazards', {
        'type': 'geojson',
        'data': hazardData
      });

      map.addLayer({
        'id': 'hazard-markers',
        'type': 'circle',
        'source': 'hazards',
        'paint': {
          'circle-radius': [
            'case',
            ['==', ['get', 'severity'], 'Critical'], 20,
            ['==', ['get', 'severity'], 'High'], 16,
            12
          ],
          'circle-color': [
            'case',
            ['==', ['get', 'type'], 'tsunami'], '#dc2626',
            ['==', ['get', 'type'], 'storm'], '#ea580c',
            ['==', ['get', 'type'], 'waves'], '#d97706',
            ['==', ['get', 'type'], 'flood'], '#0891b2',
            '#64748b'
          ],
          'circle-stroke-color': '#ffffff',
          'circle-stroke-width': 3,
          'circle-opacity': 0.9
        }
      });

      map.addLayer({
        'id': 'hazard-symbols',
        'type': 'symbol',
        'source': 'hazards',
        'layout': {
          'text-field': [
            'case',
            ['==', ['get', 'type'], 'tsunami'], 'üåä',
            ['==', ['get', 'type'], 'storm'], 'üåÄ',
            ['==', ['get', 'type'], 'waves'], 'üåä',
            ['==', ['get', 'type'], 'flood'], 'üíß',
            '‚ö†'
          ],
          'text-size': 18,
          'text-allow-overlap': true,
          'text-ignore-placement': true
        }
      });

      map.on('click', 'hazard-markers', (e) => {
        const properties = e.features[0].properties;
        const coordinates = e.features[0].geometry.coordinates.slice();

        const popupContent = `
          <div style="font-family: 'Segoe UI', sans-serif; min-width: 200px;">
            <div style="background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; padding: 12px; margin: -10px -10px 10px -10px; border-radius: 8px 8px 0 0;">
              <strong style="font-size: 16px;">${properties.title}</strong>
            </div>
            <div style="padding: 0 5px;">
              <p style="margin: 8px 0; color: #64748b; font-size: 13px;"><strong>üìç Location:</strong> ${properties.location}</p>
              <p style="margin: 8px 0; color: #64748b; font-size: 12px; line-height: 1.4;">${properties.description}</p>
              <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 11px; color: #64748b;">
                <span><strong>üìä ${properties.reports} reports</strong></span>
                <span><strong>‚ö† ${properties.severity}</strong></span>
              </div>
              <div style="text-align: center; margin-top: 8px; font-size: 11px; color: #94a3b8;">
                ${properties.time}
              </div>
            </div>
          </div>
        `;

        new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML(popupContent)
          .addTo(map);
      });

      map.on('mouseenter', 'hazard-markers', () => {
        map.getCanvas().style.cursor = 'pointer';
      });

      map.on('mouseleave', 'hazard-markers', () => {
        map.getCanvas().style.cursor = '';
      });

      map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');
      map.addControl(new mapboxgl.FullscreenControl(), 'bottom-right');
    });

    // User location
    let userLocationMarker = null;

    window.askForLocation = function() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported by this browser.");
        return;
      }

      const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };

      navigator.geolocation.getCurrentPosition(
        function success(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          
          if (userLocationMarker) {
            userLocationMarker.remove();
          }

          userLocationMarker = new mapboxgl.Marker({
            color: '#2563eb',
            scale: 0.8
          })
          .setLngLat([lon, lat])
          .setPopup(new mapboxgl.Popup().setHTML('<strong>üìç Your Location</strong>'))
          .addTo(map);

          map.flyTo({
            center: [lon, lat],
            zoom: 12,
            duration: 2000
          });
        },
        function error(err) {
          console.warn('Geolocation error', err);
          alert("Unable to get location. Please allow location access.");
        },
        options
      );
    }

    // Map controls
    window.toggleHeatmap = function() {
      console.log('üî• Heatmap toggled');
      
      if (map.getLayer('hazard-heatmap')) {
        map.removeLayer('hazard-heatmap');
        map.removeSource('hazard-heatmap-source');
      } else {
        map.addSource('hazard-heatmap-source', {
          'type': 'geojson',
          'data': hazardData
        });

        map.addLayer({
          'id': 'hazard-heatmap',
          'type': 'heatmap',
          'source': 'hazard-heatmap-source',
          'maxzoom': 15,
          'paint': {
            'heatmap-weight': [
              'case',
              ['==', ['get', 'severity'], 'Critical'], 1,
              ['==', ['get', 'severity'], 'High'], 0.7,
              0.4
            ],
            'heatmap-intensity': [
              'interpolate',
              ['linear'],
              ['zoom'],
              0, 1,
              15, 3
            ],
            'heatmap-color': [
              'interpolate',
              ['linear'],
              ['heatmap-density'],
              0, 'rgba(33,102,172,0)',
              0.2, 'rgb(103,169,207)',
              0.4, 'rgb(209,229,240)', 
              0.6, 'rgb(253,219,199)',
              0.8, 'rgb(239,138,98)',
              1, 'rgb(178,24,43)'
            ],
            'heatmap-radius': [
              'interpolate',
              ['linear'],
              ['zoom'],
              0, 20,
              15, 40
            ]
          }
        }, 'hazard-markers');
      }
    }

    window.toggleClusters = function() {
      console.log('üìç Clusters toggled');
      if (map.getLayoutProperty('hazard-markers', 'visibility') === 'visible') {
        map.setLayoutProperty('hazard-markers', 'visibility', 'none');
        map.setLayoutProperty('hazard-symbols', 'visibility', 'none');
      } else {
        map.setLayoutProperty('hazard-markers', 'visibility', 'visible');
        map.setLayoutProperty('hazard-symbols', 'visibility', 'visible');
      }
    }

    window.refreshData = function() {
      console.log('üîÑ Refreshing map data...');
      
      const refreshButton = document.querySelector('.map-control-btn[title="Refresh"]');
      refreshButton.style.transform = 'rotate(360deg)';
      refreshButton.style.transition = 'transform 1s ease';
      
      setTimeout(() => {
        const updatedData = {...hazardData};
        updatedData.features.forEach(feature => {
          feature.properties.reports += Math.floor(Math.random() * 3);
        });
        
        map.getSource('hazards').setData(updatedData);
        refreshButton.style.transform = 'rotate(0deg)';
        console.log('‚úÖ Map data refreshed');
      }, 1000);
    }

    window.toggleFullscreen = function() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    window.map = map;

    document.getElementById('searchBar').addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      console.log('üîç Searching for:', searchTerm);
      
      if (searchTerm.length > 2) {
        const filteredFeatures = hazardData.features.filter(feature => 
          feature.properties.location.toLowerCase().includes(searchTerm) ||
          feature.properties.type.toLowerCase().includes(searchTerm) ||
          feature.properties.title.toLowerCase().includes(searchTerm)
        );

        if (filteredFeatures.length > 0) {
          const bounds = new mapboxgl.LngLatBounds();
          filteredFeatures.forEach(feature => {
            bounds.extend(feature.geometry.coordinates);
          });
          map.fitBounds(bounds, { padding: 50 });
        }
      }
    });

    console.log('üåä OceanSafe Dashboard with Mapbox loaded successfully!');
    // Add this HTML for the report modal (insert before closing body tag)
const reportModallHTML = `
<div id="reportModall" class="modal">
  <div class="modal-content" style="width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
    <span class="close-btn" onclick="closeModal('reportModall')">&times;</span>
    <h3>üö® Submit Hazard Report</h3>
    
    <div style="margin-bottom: 15px;">
      <label style="display: block; font-weight: 600; margin-bottom: 5px;">Hazard Type *</label>
      <select id="hazardType" required>
        <option value="">Select hazard type...</option>
        <option value="tsunami">üåä Tsunami</option>
        <option value="storm">üåÄ Storm Surge</option>
        <option value="waves">üåä High Waves</option>
        <option value="flood">üíß Coastal Flooding</option>
        <option value="erosion">üèîÔ∏è Coastal Erosion</option>
        <option value="other">‚ö†Ô∏è Other</option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: block; font-weight: 600; margin-bottom: 5px;">Severity Level *</label>
      <select id="severityLevel" required>
        <option value="">Select severity...</option>
        <option value="low">üü¢ Low - Minor concern</option>
        <option value="medium">üü° Medium - Moderate risk</option>
        <option value="high">üü† High - Significant danger</option>
        <option value="critical">üî¥ Critical - Immediate threat</option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: block; font-weight: 600; margin-bottom: 5px;">Location *</label>
      <input type="text" id="reportLocation" placeholder="Enter location or use GPS" required>
      <button type="button" onclick="getCurrentLocation()" style="width: auto; padding: 8px 12px; margin-top: 5px; font-size: 12px;">
        üìç Use Current Location
      </button>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: block; font-weight: 600; margin-bottom: 5px;">Description *</label>
      <textarea id="reportDescription" rows="4" placeholder="Describe what you observed in detail..." required></textarea>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: block; font-weight: 600; margin-bottom: 5px;">Photo Evidence</label>
      <input type="file" id="reportPhoto" accept="image/*" onchange="previewPhoto()">
      <div id="photoPreview" style="margin-top: 10px;"></div>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: flex; align-items: center; gap: 8px;">
        <input type="checkbox" id="anonymousReport">
        <span>Submit anonymously</span>
      </label>
    </div>

    <button onclick="submitHazardReport()" style="background: linear-gradient(135deg, #dc2626, #ef4444);">
      üö® Submit Report
    </button>
  </div>
</div>`;

// Add modal to page
document.body.insertAdjacentHTML('beforeend', reportModallHTML);

// Report submission functions
function getCurrentLocation() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }

  document.getElementById('reportLocation').value = "Getting location...";
  
  navigator.geolocation.getCurrentPosition(
    function(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      
      // Reverse geocoding (simplified)
      fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lon},${lat}.json?access_token=${mapboxgl.accessToken}`)
        .then(response => response.json())
        .then(data => {
          if (data.features && data.features[0]) {
            document.getElementById('reportLocation').value = data.features[0].place_name;
          } else {
            document.getElementById('reportLocation').value = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
          }
        })
        .catch(() => {
          document.getElementById('reportLocation').value = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
        });
    },
    function(error) {
      document.getElementById('reportLocation').value = "";
      alert("Unable to get location: " + error.message);
    }
  );
}

function previewPhoto() {
  const file = document.getElementById('reportPhoto').files[0];
  const preview = document.getElementById('photoPreview');
  
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px;">`;
    };
    reader.readAsDataURL(file);
  } else {
    preview.innerHTML = '';
  }
}

async function submitHazardReport() {
  const hazardType = document.getElementById('hazardType').value;
  const severity = document.getElementById('severityLevel').value;
  const location = document.getElementById('reportLocation').value;
  const description = document.getElementById('reportDescription').value;
  const anonymous = document.getElementById('anonymousReport').checked;
  
  if (!hazardType || !severity || !location || !description) {
    alert('Please fill in all required fields');
    return;
  }

  const reportData = {
    hazardType,
    severity,
    location,
    description,
    anonymous,
    timestamp: new Date(),
    status: 'pending',
    userId: anonymous ? null : (window.currentUser?.uid || 'guest')
  };

  try {
    // Show loading state
    const submitBtn = event.target;
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '‚è≥ Submitting...';
    submitBtn.disabled = true;

    // Save to Firebase (if available) or local storage
    if (window.db) {
      await window.db.collection('reports').add(reportData);
    } else {
      // Fallback to localStorage
      const reports = JSON.parse(localStorage.getItem('hazardReports') || '[]');
      reports.push({...reportData, id: Date.now().toString()});
      localStorage.setItem('hazardReports', JSON.stringify(reports));
    }

    // Success notification
    alert('‚úÖ Report submitted successfully! Authorities have been notified.');
    
    // Reset form and close modal
    document.getElementById('hazardType').value = '';
    document.getElementById('severityLevel').value = '';
    document.getElementById('reportLocation').value = '';
    document.getElementById('reportDescription').value = '';
    document.getElementById('reportPhoto').value = '';
    document.getElementById('photoPreview').innerHTML = '';
    document.getElementById('anonymousReport').checked = false;
    
    closeModal('reportModall');
    
    // Update dashboard stats
    updateDashboardStats();
    
  } catch (error) {
    console.error('Error submitting report:', error);
    alert('‚ùå Error submitting report. Please try again.');
  } finally {
    // Reset button
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

function showAnalyticss() {
  // Create analytics modal
  const analyticsModalHTML = `
    <div id="analyticsModal" class="modal">
      <div class="modal-content" style="width: 95%; max-width: 1000px; height: 90vh; overflow-y: auto;">
        <span class="close-btn" onclick="closeModal('analyticsModal')">&times;</span>
        <h3>üìä Advanced Analytics Dashboard</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: #dc2626;">47</div>
            <div style="font-size: 0.9rem; color: #64748b;">Reports Today</div>
          </div>
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: #3b82f6;">2.3h</div>
            <div style="font-size: 0.9rem; color: #64748b;">Avg Response Time</div>
          </div>
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: #10b981;">96%</div>
            <div style="font-size: 0.9rem; color: #64748b;">Verification Rate</div>
          </div>
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: #f59e0b;">7.2M</div>
            <div style="font-size: 0.9rem; color: #64748b;">People Protected</div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px;">
            <h4 style="margin-bottom: 15px; color: #1e40af;">üìà Hazard Trends (30 Days)</h4>
            <canvas id="trendChart" width="400" height="200"></canvas>
          </div>
          <div style="background: #f8fafc; padding: 20px; border-radius: 12px;">
            <h4 style="margin-bottom: 15px; color: #1e40af;">üó∫Ô∏è Geographic Distribution</h4>
            <div style="text-align: center; color: #64748b; padding: 40px;">
              <div>Tamil Nadu: 34%</div>
              <div>Kerala: 28%</div>
              <div>Maharashtra: 22%</div>
              <div>Gujarat: 16%</div>
            </div>
          </div>
        </div>

        <div style="background: #f8fafc; padding: 20px; border-radius: 12px;">
          <h4 style="margin-bottom: 15px; color: #1e40af;">üìä Export Options</h4>
          <div style="display: flex; gap: 10px;">
            <button onclick="exportData('csv')" style="width: auto; padding: 8px 16px; font-size: 14px;">üìÑ Export CSV</button>
            <button onclick="exportData('pdf')" style="width: auto; padding: 8px 16px; font-size: 14px;">üìã Export Report</button>
            <button onclick="exportData('json')" style="width: auto; padding: 8px 16px; font-size: 14px;">üíæ Export JSON</button>
          </div>
        </div>
      </div>
    </div>`;

  // Add modal if it doesn't exist
  if (!document.getElementById('analyticsModal')) {
    document.body.insertAdjacentHTML('beforeend', analyticsModalHTML);
  }

  // Show modal
  openModal('analyticsModal');

  // Initialize trend chart
  setTimeout(() => {
    const ctx = document.getElementById('trendChart');
    if (ctx && !ctx.chart) {
      ctx.chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [
            {
              label: 'Tsunami',
              data: [12, 8, 15, 9],
              borderColor: '#dc2626',
              backgroundColor: 'rgba(220, 38, 38, 0.1)',
            },
            {
              label: 'Storm Surge',
              data: [18, 25, 20, 28],
              borderColor: '#ea580c',
              backgroundColor: 'rgba(234, 88, 12, 0.1)',
            },
            {
              label: 'High Waves',
              data: [45, 52, 48, 61],
              borderColor: '#d97706',
              backgroundColor: 'rgba(217, 119, 6, 0.1)',
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            }
          }
        }
      });
    }
  }, 100);
}

function exportData(format) {
  // Sample data export functionality
  const data = {
    timestamp: new Date().toISOString(),
    totalReports: 1247,
    criticalAlerts: 8,
    resolvedIssues: 234,
    socialMentions: 12400
  };

  switch(format) {
    case 'csv':
      const csv = Object.entries(data).map(([key, value]) => `${key},${value}`).join('\n');
      downloadFile(csv, 'hazard-data.csv', 'text/csv');
      break;
    case 'json':
      downloadFile(JSON.stringify(data, null, 2), 'hazard-data.json', 'application/json');
      break;
    case 'pdf':
      alert('üìã PDF report will be generated and emailed to your registered address.');
      break;
  }
}

function downloadFile(content, filename, contentType) {
  const blob = new Blob([content], { type: contentType });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
}

function showEmergencyResponse() {
  const emergencyModalHTML = `
    <div id="emergencyModal" class="modal">
      <div class="modal-content" style="width: 90%; max-width: 600px;">
        <span class="close-btn" onclick="closeModal('emergencyModal')">&times;</span>
        <h3>üö® Emergency Response Center</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
          <button onclick="contactEmergency('ndrf')" style="background: #dc2626; padding: 15px; font-size: 14px;">
            üöë Contact NDRF<br><small>National Disaster Response Force</small>
          </button>
          <button onclick="contactEmergency('coastguard')" style="background: #0891b2; padding: 15px; font-size: 14px;">
            üö¢ Coast Guard<br><small>Indian Coast Guard</small>
          </button>
          <button onclick="contactEmergency('incois')" style="background: #3b82f6; padding: 15px; font-size: 14px;">
            üåä INCOIS<br><small>Ocean Information Services</small>
          </button>
          <button onclick="contactEmergency('local')" style="background: #f59e0b; padding: 15px; font-size: 14px;">
            üëÆ Local Authority<br><small>District Collector</small>
          </button>
        </div>

        <div style="background: #fef2f2; padding: 15px; border-radius: 10px; border-left: 4px solid #dc2626; margin-bottom: 20px;">
          <h4 style="color: #dc2626; margin-bottom: 10px;">‚ö†Ô∏è Active Alerts</h4>
          <div style="font-size: 14px;">
            ‚Ä¢ Tsunami warning - Chennai Coast (15 min ago)<br>
            ‚Ä¢ High wave alert - Mumbai Harbor (32 min ago)<br>
            ‚Ä¢ Storm surge watch - Kochi (1 hour ago)
          </div>
        </div>

        <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
          <h4 style="color: #10b981; margin-bottom: 10px;">‚úÖ Response Status</h4>
          <div style="font-size: 14px;">
            ‚Ä¢ NDRF teams deployed: 3 locations<br>
            ‚Ä¢ Coast Guard vessels: 12 active<br>
            ‚Ä¢ Evacuation centers: 45 ready<br>
            ‚Ä¢ Emergency contacts: All operational
          </div>
        </div>
      </div>
    </div>`;

  if (!document.getElementById('emergencyModal')) {
    document.body.insertAdjacentHTML('beforeend', emergencyModalHTML);
  }
  
  openModal('emergencyModal');
}

function contactEmergency(type) {
  const contacts = {
    ndrf: { name: 'NDRF', phone: '011-26105579', email: 'control@ndrf.gov.in' },
    coastguard: { name: 'Coast Guard', phone: '1554', email: 'ops@indiancoastguard.gov.in' },
    incois: { name: 'INCOIS', phone: '040-23886001', email: 'director@incois.gov.in' },
    local: { name: 'Local Authority', phone: '108', email: 'emergency@district.gov.in' }
  };

  const contact = contacts[type];
  const message = `Contact ${contact.name}:\n\nPhone: ${contact.phone}\nEmail: ${contact.email}\n\nWould you like to:`;
  
  if (confirm(`${message}\n\n‚Ä¢ Call Now (Yes)\n‚Ä¢ Send Email (No)\n‚Ä¢ Cancel`)) {
    window.open(`tel:${contact.phone}`);
  } else {
    window.open(`mailto:${contact.email}?subject=Emergency Response Required&body=Urgent assistance needed for ocean hazard event.`);
  }
}



  </script>
</body>
</html>
